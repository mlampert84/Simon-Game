function oscToButton(e){switch(e){case osc1:return"button1";case osc2:return"button2";case osc3:return"button3";case osc4:return"button4";case errorOSC:return"errorTone";default:return""}}function startTone(e){machineOn&&(e.connect(vol),vol.connect(audioCtx.destination),$("#"+oscToButton(e)).addClass("active"),currentTone=e)}function stopTone(e){[osc1,osc2,osc3,osc4,errorOSC].forEach(function(t){currentTone==t&&(e.disconnect(vol),vol.disconnect(audioCtx.destination))}),currentTone=void 0,machineOn&&$("#"+oscToButton(e)).removeClass("active")}function playSequence(notes,playDuration,pauseDuration){var whichButton;switch(notes[0]){case 1:whichButton="#button1";break;case 2:whichButton="#button2";break;case 3:whichButton="#button3";break;case 4:whichButton="#button4";break;default:return}startTone(eval("osc"+notes[0])),setTimeout(function(){stopTone(eval("osc"+notes[0])),notes.shift(),setTimeout(function(){playSequence(notes,playDuration,pauseDuration)},pauseDuration)},playDuration)}function errorSequence(){var e=5;errorOSC.connect(vol),vol.connect(audioCtx.destination),currentTone=errorOSC,buttonsOn=!1,myGlobalInterval=setInterval(function(){0===e?(clearInterval(myGlobalInterval),errorOSC.disconnect(vol),vol.disconnect(audioCtx.destination),currentTone=void 0,strictMode?signalGameStart(2):showAndTestPlayer()):e%2==1?($("#count-panel").text("!!"),e--):($("#count-panel").text(""),e--)},300)}function checkPlayer(e){var t=parseInt(e.charAt(6));console.log(t),t===computerSequence[playerSequence.length]?playerSequence.push(t):playerSequence=void 0}function random1to4(){return Math.floor(4*Math.random())+1}function showAndTestPlayer(){for(var e=[],t=0;t<computerSequence.length;t++)e[t]=computerSequence[t];setTimeout(function(){$("#count-panel").text(computerSequence.length),playSequence(e,420,50)},1e3),myGlobalInterval=setInterval(function(){0===e.length&&(clearInterval(myGlobalInterval),console.log("Computer showed sequence. Waiting for player."),buttonsOn=!0,playerSequence=[],playerIsPlaying=!0,myGlobalInterval=setInterval(function(){void 0===playerSequence?(clearInterval(myGlobalInterval),console.log("Player messed up sequence."),playerIsPlaying=!1,buttonsOn=!1,errorSequence()):playerSequence.length===computerSequence.length?(clearInterval(myGlobalInterval),console.log("Player correctly entered the sequence.  Now adding one more."),playerIsPlaying=!1,buttonsOn=!1,playOneRound()):playerSequence.length>computerSequence.length&&(clearInterval(myGlobalInterval),console.log("Player messed up sequence."),playerIsPlaying=!1,buttonsOn=!1,errorSequence())},10))},10)}function winSequence(e){buttonsOn=!1,$("#count-panel").text(""),setTimeout(function(){$("#count-panel").text("**"),e>1?setTimeout(function(){winSequence(e-1)},300):(computerSequence=[],buttonsOn=!0,signalGameStart(2))},300)}function playOneRound(){computerSequence.push(random1to4()),computerSequence.length>20?(playSequence([2,4,4,4,4,4,1,3,1,1],300,5),winSequence(8)):(console.log("Adding a button to the sequence."),console.log(computerSequence),showAndTestPlayer())}function signalGameStart(e){buttonsOn=!1,$("#count-panel").text(""),setTimeout(function(){$("#count-panel").text("--"),e>1?setTimeout(function(){signalGameStart(e-1)},400):(computerSequence=[],playOneRound())},400)}var AudioContext=window.AudioContext||window.webkitAudioContext,audioCtx=new AudioContext,vol=audioCtx.createGain();vol.gain.value=.02;var osc1=audioCtx.createOscillator();osc1.frequency.value=440,osc1.type="square",osc1.start();var osc2=audioCtx.createOscillator();osc2.frequency.value=349,osc2.type="square",osc2.start();var osc3=audioCtx.createOscillator();osc3.frequency.value=523,osc3.type="square",osc3.start();var osc4=audioCtx.createOscillator();osc4.frequency.value=466,osc4.type="square",osc4.start();var errorOSC=audioCtx.createOscillator();errorOSC.frequency.value=210,errorOSC.type="square",errorOSC.start();var machineOn=!1,buttonsOn=!1,turningOff=!1,strictMode=!1,playerSequence=void 0,computerSequence=[],playerIsPlaying=!1,myGlobalInterval,currentTone=void 0,buttonTones={button1:osc1,button2:osc2,button3:osc3,button4:osc4},keyToTones={37:osc3,38:osc4,39:osc1,40:osc2},keyToButtons={37:"button3",38:"button4",39:"button1",40:"button2"};$("#toggle-switch").click(function(){if($("input").prop("checked"))machineOn=!0,buttonsOn=!0,playSequence([1,2,3,4],100,100),$("#count-panel").text("--");else if(!$("input").prop("checked")){turningOff=!0,clearInterval(myGlobalInterval);var e=[osc1,osc2,osc3,osc4,errorOSC];e.forEach(function(e){currentTone==e&&stopTone(currentTone)}),buttonsOn=!1,playerIsPlaying=!1,playerSequence=void 0,playSequence([4,3,2,1],100,100),setTimeout(function(){$("input").prop("checked")||(strictMode&&$("#strict-button").click(),$("#count-panel").text(""),computerSequence=[],machineOn=!1,turningOff=!1)},800)}}),$("#strict-button").click(function(){machineOn&&(strictMode=!strictMode,strictMode?$("#strict-indicator-light").css("background-color","darkred"):$("#strict-indicator-light").css("background-color","black"))}),$(document).keydown(function(e){buttonsOn&&e.which in keyToTones&&startTone(keyToTones[e.which]),e.preventDefault()}),$(document).keyup(function(e){buttonsOn&&e.which in keyToTones&&stopTone(keyToTones[e.which]),playerIsPlaying&&checkPlayer(keyToButtons[e.which]),e.preventDefault()}),$("#button1,#button2,#button3,#button4").mousedown(function(){buttonsOn&&startTone(buttonTones[this.id])}),$("#button1,#button2,#button3,#button4").mouseup(function(){buttonsOn&&stopTone(buttonTones[this.id]),playerIsPlaying&&checkPlayer(this.id)}),$("#start-button").click(function(){machineOn&&buttonsOn&&signalGameStart(2)});